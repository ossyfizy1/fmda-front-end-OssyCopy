<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Individual Member Registration">
  <meta name="author" content="Softworks">

  <link rel="stylesheet" type="text/css" href="new_assets/scss/register.min.css">
  <link rel="stylesheet" type="text/css" href="new_assets/plugins/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="new_assets/icons/font-awesome/css/font-awesome.min.css">

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">

  <title>FMDA- Individual Member Registration</title>

</head>

<body>


  <div class="col-md-12" style="margin-top: 20px;"> 

  <!--content here-->
  <section id="number-tabs">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-content collapse show">
                    <div class="card-body">

                          <h2 style="background-color: black; color: white;">Employment History</h2> 
                          <hr>

                          <a class="btn btn-light" href="/onboarding_ind">Previous Page</a>
                          <a style="float: right;" class="btn btn-light" href="/logout">Log Out</a>

                          <!-- first step -->
                          <form action="/ind_professionalInformation" method="post" class="form-horizontal" enctype="multipart/form-data">
                            <fieldset id="ourFieldset2">
                                <div class="row">
                                    
                                    <!-- <div class="col-md-12" style="margin-top: 20px">
                                        <div class="form-group">
                                            <label for="phoneNumber1"> Treasury Certification (pdf) :</label>
                                            <input name="treasuryCertificate" type="file" id="treasuryCertificate" placeholder="treasury certification" required>
                                        </div>
                                        
                                        <hr>
                                        
                                    </div> -->



                                    <%= //JSON.stringify(memberDetails.lookupMember.member.employmentHistory.length) %> 

                                    <%= //JSON.stringify(memberDetails.lookupMember.member.employmentHistory) %> 

                                    
                                    <!-- to hold employment history -->
                                    <div class="row" style="margin-left: 10px">
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="phoneNumber1"> Name of Organization :</label>
                                                <input id="organisationName" type="text" class="form-control" placeholder="Name of Organization">
                                            </div>
                                        </div>

                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="phoneNumber1"> Position Held :</label>
                                                <input id="positionHeld" type="text" class="form-control" placeholder="Position Held">
                                            </div>
                                        </div>
    
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label>Start Date :</label>
                                                <input id="startDate" type='date' class="form-control" placeholder="Start Date" />
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label>End Date :</label>
                                                <input id="endDate" type='date' class="form-control" placeholder="Start Date" />
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label for="phoneNumber1"> Major Responsibilities :</label>
                                                <input id="responsibilities" type="text" class="form-control"  placeholder="Major Responsibilities, Comma Seperated">
                                            </div>
                                        </div>

                                        <div class="col-md-12">
                                                <p id="addMoreEH" class="btn btn-light">add to list</p>
                                        </div>


                                        <!-- if employmentHistory already exist & show this button-->
                                        <% if( memberDetails.lookupMember.member.employmentHistory.length > 0)
                                        { 
                                            
                                        %> 
                                        <div class="col-md-12">
                                            <a href="/ind_qualifications" id="click_to_continue_from_where_u_left_off" class="btn btn-primary" style="float: right;">click to continue from where u left off</a>
                                        </div>
                                        <% } %> 



                                        <!-- where to display the list of List Off EmploymentHistory added -->
                                        <div id="savedListOffEmploymentHistory" class="col-md-12"></div>


                                        <div class="col-md-12" style="margin-top: 50px;">
                                            <!--<input type="submit" id="submit" class="btn btn-light"/>-->
                                            <p id="submitEmplomentList" class="btn btn-primary" onclick="submitEmplomentList()">Submit</p>
                                        </div>


                                        <!-- if employmentHistory already exist -->
                                        <% if( memberDetails.lookupMember.member.employmentHistory.length > 0)
                                        { 
                                            
                                        %> 
                                            <div class="col-md-12" style="margin-top: 30px">
                                            <p>Previously added (Employment history)</p>     
                                            <table class="table table-striped">
                                                <thead>
                                                <tr>
                                                    <th>organisation name:</th>
                                                    <th>position held</th>
                                                    <th>start date</th>
                                                    <th>end date</th>
                                                    <th>responsibilities</th>
                                                    <!-- <th></th> -->
                                                    <th></th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                    
                                                    <% 
                                    
                                                        var employmentHistoryListGotten = memberDetails.lookupMember.member.employmentHistory;
                                    
                                                        for (let index = 0; index < employmentHistoryListGotten.length; index++) 
                                                        {
                                                            const element = employmentHistoryListGotten[index];
                                                    %>     
                                    
                                                    <tr>
                                                        <td class="getTheClass"> <%= element.organisationName %> </td>
                                                        <td><%= element.positionHeld %></td>
                                                        <td><%= element.startDate %></td>
                                                        <td><%= element.endDate %></td>
                                                        <td><%= element.responsibilities %></td>
                                                        <!-- <td><input class="inputField" name="name" type="text" class="form-control" value="<%= element.organisationName %>"></td> -->
                                                        <!--<td><p class="deleteButton btn btn-default" id="<%= //element.organisationName %>"  value="<%= //element.organisationName %>">remove</p></td>-->
                                                    </tr>
                                    
                                                    <% 
                                                        }
                                                    %>
                                     
                                                </tbody>
                                            </table>
                                            </div>

                                        <% } %> 


                                        
                                    </div>

                                    
                                </div>

                            </fieldset>
                          </form>
                          <!-- end of first step 1-->


                          <!-- jquery & ajax link -->
                     <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js "></script>

                     <!-- for the fancy sweet alert box -->
                    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>


                    <!-- to check if div with id savedListOffEmploymentHistory is empty or not -->
                    <script>
                        $(document).ready(function(){
                          
                            if ($('#savedListOffEmploymentHistory').is(':empty')){
                                    $("#submitEmplomentList").hide()
                                }
                        });
                    </script>


                    <!-- add to list -->
                    <script>

                          var employmentHistoryList = [];

                          $("#addMoreEH").click(function(){
                            //  alert("add more o");

                            

                                var organisationName = $("#organisationName").val();
                                var positionHeld = $("#positionHeld").val();
                                var startDate = $("#startDate").val();
                                var endDate = $("#endDate").val();
                                var responsibilities = $("#responsibilities").val();


                                if(organisationName == '' || positionHeld == '' || startDate == '' || endDate == '' || responsibilities == ''){

                                    // using sweet alert tutorial at https://sweetalert.js.org/
                                    // swal(
                                    //         {
                                    //             title: "info!",
                                    //             text: "kindly fill all fields...",
                                    //             icon: "info",
                                    //         },
                                            
                                    //     );

                                    swal("kindly fill all fields!", {
                                            buttons: false,
                                            timer: 2000,  // disappears after 2 seconds
                                        });


                                      
                                  }
                                  else
                                  {

                                          // convert it to object
                                          var addAsObject = {
                                              organisationName : organisationName,
                                              positionHeld : positionHeld,
                                              startDate : startDate,
                                              endDate : endDate,
                                              commaResponsibilities : responsibilities
                                          }


                                        employmentHistoryList.push(addAsObject);
                                        console.log(employmentHistoryList)

                                        var html = "<table class='table table-striped'>";
                                        for (var i = 0; i < employmentHistoryList.length; i++) {
                                            
                                            html+="<tr>";
                                            html+="<td>"+employmentHistoryList[i].organisationName+"</td>";
                                            html+="<td>"+employmentHistoryList[i].positionHeld+"</td>";
                                            html+="<td>"+employmentHistoryList[i].startDate+"</td>";
                                            html+="<td>"+employmentHistoryList[i].endDate+"</td>";
                                            html+="<td>"+employmentHistoryList[i].commaResponsibilities+"</td>";
                                            html+="<td class='deleteButton btn btn-default' id='"+employmentHistoryList[i].organisationName+"' value='"+employmentHistoryList[i].organisationName+"' onClick='deleteFunction("+i+")'><i class='fa fa-trash'></i></td>";
                                            
                                            html+="</tr>";

                                        }
                                        html+="</table>";

                                        // display record
                                        $("#savedListOffEmploymentHistory").html(html);


                                        // empty fields
                                        $("#organisationName").val("");
                                        $("#positionHeld").val("");
                                        $("#startDate").val("");
                                        $("#endDate").val("");
                                        $("#responsibilities").val("");
                                                
                                  }

                                  // show
                                  if(employmentHistoryList.length > 0){
                                        $("#submitEmplomentList").show();
                                    };
                                  

                          });

                        
                        // function to delete items
                        function deleteFunction(param){
                            // console.log(param);
                            // console.log(employmentHistoryList);
                            // console.log(employmentHistoryList[0]);

                            // someArray.splice(x, 1);

                            employmentHistoryList.splice(param, 1);
                            console.log(employmentHistoryList);
                            console.log(employmentHistoryList.length);

                            var html = "<table class='table table-striped'>";
                            for (var i = 0; i < employmentHistoryList.length; i++) {
                                
                                html+="<tr>";
                                html+="<td>"+employmentHistoryList[i].organisationName+"</td>";
                                html+="<td>"+employmentHistoryList[i].positionHeld+"</td>";
                                html+="<td>"+employmentHistoryList[i].startDate+"</td>";
                                html+="<td>"+employmentHistoryList[i].endDate+"</td>";
                                html+="<td>"+employmentHistoryList[i].commaResponsibilities+"</td>";
                                html+="<td id='"+employmentHistoryList[i].organisationName+"' value='"+employmentHistoryList[i].organisationName+"' onClick='deleteFunction("+i+")'><i class='fa fa-trash'></i></td>";
                                
                                html+="</tr>";

                            }
                            html+="</table>";
                            $("#savedListOffEmploymentHistory").html(html);


                            // show
                            if(employmentHistoryList.length == 0){
                                $("#submitEmplomentList").hide();
                            }
                        }

                        
                        // function to submit the List
                        function submitEmplomentList(){
                            console.log("to submit: "+ JSON.stringify(employmentHistoryList));

                            //  call "/ind_professionalInformation" endpoint to add emplyoment history
                            $.post("/ind_professionalInformation", {"values":JSON.stringify(employmentHistoryList)}, function(data){
                                
                                // empty the fields
                                $("#organisationName").val("");
                                $("#positionHeld").val("");
                                $("#startDate").val("");
                                $("#endDate").val("");
                                $("#responsibilities").val("");

                                if (data == "Successful !") {
                                    window.location.href='/ind_qualifications';
                                } else if(data == "failed, kindly contact the admin") {
                                    alert("try again or contact the admin.")
                                }

                            });
                        }

                    </script>


                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
  <!--end of content-->

</div>



  
  <script src="new_assets/js/register-form.js"></script>

  <!-- BEGIN: Page Vendor JS-->
  <script src="app-assets/vendors/js/ui/jquery.sticky.js"></script>
  <script src="app-assets/vendors/js/extensions/jquery.steps.min.js"></script>
  <script src="app-assets/vendors/js/pickers/dateTime/moment-with-locales.min.js"></script>
  <script src="app-assets/vendors/js/pickers/daterange/daterangepicker.js"></script>
  <script src="app-assets/vendors/js/forms/validation/jquery.validate.min.js"></script>
  <!-- END: Page Vendor JS-->

  <!-- BEGIN: Theme JS-->
  <script src="app-assets/js/core/app-menu.min.js"></script>
  <script src="app-assets/js/core/app.min.js"></script>
  <script src="app-assets/js/scripts/customizer.min.js"></script>
  <script src="app-assets/js/scripts/footer.min.js"></script>
  <!-- END: Theme JS-->

  <!-- BEGIN: Page JS-->
  <script src="app-assets/js/scripts/pages/material-app.min.js"></script>
  <script src="app-assets/js/scripts/forms/wizard-steps.min.js"></script>
  <!-- END: Page JS-->

</body>

</html>
